<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Field</title>

    <link rel="stylesheet" href="pci-fields-styles.css">
</head>

<body>
    <input type="text" id="secure-input" placeholder="CVV">
    <span class="input-error" id="secure-error"></span>
</body>

<script>
    const inputField = document.getElementById("secure-input");
    const errorWrapper = document.getElementById("secure-error");

    document.addEventListener("DOMContentLoaded", () => {
        window.addEventListener("message", (event) => {
            if (event.data.type === "PB_PCI_GET_VALUES") {
                event.source.postMessage({
                    type: "PB_PCI_FIELD_VALUE",
                    field: "cvv",
                    value: inputField.value
                }, "*");
            }

            if (event.data.type === 'PB_PCI_METADATA') {
                inputField.placeholder = event.data.data.placeholder;

                if (event.data.data.css) {
                    const cssData = document.createElement('style');
                    const sanitizedCSS = event.data.data.css.replace(/<\/?script[^>]*>/gi, "").replace(/<\/?style[^>]*>/gi, "");

                    cssData.type = "text/css";
                    cssData.innerHTML = sanitizedCSS;

                    document.head.appendChild(cssData);
                }
            }

            if (event.data.type === 'PB_PCI_FIELD_ERROR') {
                errorWrapper.classList.add('input-error');
                errorWrapper.innerText = event.data.data.errorData.message;
            }

            if (event.data.type === 'PB_PCI_CLEAR_ERROR') {
                errorWrapper.querySelector.classList.remove('input-error');
            }
        });
    });
</script>

</html>