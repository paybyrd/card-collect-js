<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Field</title>

    <link rel="stylesheet" href="pci-fields-styles.css">
</head>

<body>
    <div class="form-field">
        <input type="text" id="secure-input" placeholder="Card Holder">
        <span class="input-error" id="secure-error"></span>
    </div>
</body>

<script>
    const inputField = document.getElementById("secure-input");
    const errorWrapper = document.getElementById("secure-error");

    document.addEventListener("DOMContentLoaded", () => {
        window.addEventListener("message", (event) => {
            if (event.data.type === "PB_PCI_GET_VALUES") {
                event.source.postMessage({
                    type: "PB_PCI_FIELD_VALUE",
                    field: "cardHolder",
                    value: inputField.value
                }, "*");
            }

            if (event.data.type === 'PB_PCI_METADATA') {
                inputField.placeholder = event.data.data.placeholder;

                if (event.data.data.css) {
                    const css = `
                        .form-field {
                            height: 57px;
                            margin-bottom: 0;
                            box-shadow: none;
                            background: transparent;
                            transition: all 0.1s ease-in-out;
                            border-radius: 8px;
                        }
                    
                        .form-field.form-error {
                            border-color: #d32f2f;
                        }
                    
                        .form-field > input {
                            padding: 17px 10px;
                            color: #2c2c2c;
                            font-size: 16px;
                            font-family: Montserrat;
                            box-shadow: none;
                            border-radius: 8px;
                        }
                    
                        .form-field > input:hover {
                            transition: all 0.1s ease-in-out;
                            background-color: rgb(244, 244, 244);
                            border-color: #555555;
                            color: #2c2c2c;
                        }
                    `;
                    const cssData = document.createElement('style');
                    const sanitizedCSS = css.replace(/<\/?script[^>]*>/gi, "").replace(/<\/?style[^>]*>/gi, "");

                    cssData.type = "text/css";
                    cssData.innerHTML = sanitizedCSS;

                    document.head.appendChild(cssData);
                }
            }

            if (event.data.type === 'PB_PCI_FIELD_ERROR') {
                errorWrapper.classList.add('input-error');
                errorWrapper.innerText = event.data.data.errorData.message;
            }

            if (event.data.type === 'PB_PCI_CLEAR_ERROR') {
                errorWrapper.querySelector.classList.remove('input-error');
            }
        });
    });
</script>

</html>